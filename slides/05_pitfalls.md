# 05. è¨­è¨ˆä¸Šã®èª¤è§£ã¨ã‚ˆãã‚ã‚‹è½ã¨ã—ç©´
â”€ OpenID Connect ã¨ã®æ··åŒã€ãƒˆãƒ¼ã‚¯ãƒ³ç®¡ç†ã®èª¤ç”¨ã€ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¨­è¨ˆã®è¦‹è½ã¨ã—


## âŒ ã‚ˆãã‚ã‚‹èª¤è§£ã¨è½ã¨ã—ç©´

### ğŸ”» OpenID Connectï¼ˆOIDCï¼‰ã¨ã®æ··åŒ
- ã€ŒOAuthã§ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ã‚‹ã‹ã‚‰OKã€ã¨æ€ã„è¾¼ã‚€
- å®Ÿéš›ã«ã¯**IDãƒˆãƒ¼ã‚¯ãƒ³ã‚’ä¼´ã†OIDC**ã§ãªã„ã¨ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®è­˜åˆ¥ã¯ä¿è¨¼ã•ã‚Œãªã„

> âœ… å¯¾ç­–ï¼š  
> èªè¨¼ï¼ˆAuthenticationï¼‰ç›®çš„ãªã‚‰ **OIDCã®æ¡ç”¨ãŒå¿…é ˆ**  
> Symfonyã§ã¯ `openid` ã‚¹ã‚³ãƒ¼ãƒ—ã®åˆ©ç”¨ã¨IDãƒˆãƒ¼ã‚¯ãƒ³ã®æ¤œè¨¼ãŒå¿…è¦


### ğŸ”» ã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³ã‚’ä¸‡èƒ½è¦–ã™ã‚‹
- æœ‰åŠ¹æœŸé™åˆ‡ã‚Œã‚’ç„¡è¦–ã—ã¦è¨­è¨ˆ
- æ°¸ç¶šåŒ–ï¼æ›´æ–°æ‰‹æ®µã‚’æŒãŸãªã„ãŸã‚ã€APIã‚¨ãƒ©ãƒ¼é »ç™º

> âœ… å¯¾ç­–ï¼š  
> `refresh_token` ã‚’æ´»ç”¨ã—ã€**è‡ªå‹•æ›´æ–°ã®ä»•çµ„ã¿**ã‚’è¨­è¨ˆã«å«ã‚ã‚‹  
> Symfonyã§ã¯ `oauth2-client` ãƒãƒ³ãƒ‰ãƒ«ã®ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥å¯¾å¿œã‚’æ˜ç¤ºçš„ã«å®Ÿè£…


### ğŸ”» ãƒˆãƒ¼ã‚¯ãƒ³ã‚’ãƒ–ãƒ©ã‚¦ã‚¶ã«å¹³æ–‡ä¿å­˜
- `localStorage` ã‚„ `sessionStorage` ã«ãƒˆãƒ¼ã‚¯ãƒ³ã‚’ä¿å­˜ â†’ XSSã§ç›—ã¾ã‚Œã‚‹

> âœ… å¯¾ç­–ï¼š  
> ãƒ•ãƒ­ãƒ³ãƒˆã«ã¯ã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³ã‚’éœ²å‡ºã•ã›ãšã€**HttpOnly Cookie** ã§ç®¡ç†  
> APIè¨­è¨ˆã«å¿œã˜ã¦**SameSiteå±æ€§ãƒ»CSRFå¯¾ç­–**ã‚‚ã‚»ãƒƒãƒˆã§æ¤œè¨


## âœ… ã¾ã¨ã‚ï¼šè¨­è¨ˆã§æ„è­˜ã™ã¹ãä¸‰åŸå‰‡

| é …ç›®                        | æœ€ä½é™ã®è¨­è¨ˆæ„è­˜                           |
|-----------------------------|--------------------------------------------|
| **ãƒ­ã‚°ã‚¤ãƒ³ã®ä»•çµ„ã¿**       | OAuthã§ã¯ãªãã€OIDCã§IDãƒˆãƒ¼ã‚¯ãƒ³ã‚’å¾—ã‚‹    |
| **ãƒˆãƒ¼ã‚¯ãƒ³ã®æ‰±ã„æ–¹**       | æœŸé™ãƒ»æ›´æ–°ãƒ»å¤±åŠ¹ã‚’è€ƒæ…®ã—ã¦åˆ¶å¾¡ã‚’è¨­è¨ˆ     |
| **ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£**           | ãƒ•ãƒ­ãƒ³ãƒˆã‹ã‚‰è¦‹ãˆãªã„å½¢ã§ãƒˆãƒ¼ã‚¯ãƒ³ã‚’ç®¡ç†   |


> â—è¨­è¨ˆã®æ›–æ˜§ã•ã¯ã€å¾Œã‹ã‚‰ã®ä¿®æ­£ãŒå›°é›£ã«ãªã‚‹æœ€å¤§ã®åŸå› ã€‚  
> **ã€Œã¨ã‚Šã‚ãˆãšå‹•ãã€OAuthã‹ã‚‰å’æ¥­ã™ã‚‹ã“ã¨ãŒã€ãƒãƒ¼ãƒ ã®æœªæ¥ã‚’å®ˆã‚‹ä¸€æ­©ã§ã™ã‚ã€‚**


ğŸ–¼ï¸ *ï¼ˆå›³è§£ï¼šOAuth vs OIDC ï¼ ãƒˆãƒ¼ã‚¯ãƒ³ã®å®‰å…¨ãªä¿å­˜å ´æ‰€ï¼‰*  
ğŸ‘‰ `assets/diagrams/oauth_vs_oidc.png`  
ğŸ‘‰ `assets/diagrams/token_storage_risks.png`

[README.md](../README.md)<br>
[4. Symfony Ã— OAuthBundle å®Ÿè£…ã®å†…éƒ¨æ§‹é€ ](../slides/04_symfony_structure.md)<br>
[6. ãã‚Œã§ã‚‚ Symfony ãªã‚‰å®‰å¿ƒã§ãã‚‹ç†ç”±](../slides/06_why_symfony.md)<br>
